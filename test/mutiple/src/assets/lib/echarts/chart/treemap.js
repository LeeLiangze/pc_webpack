define("echarts/chart/treemap",["require","./base","zrender/tool/area","zrender/shape/Rectangle","zrender/shape/Text","zrender/shape/Line","../layout/TreeMap","../data/Tree","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/util","zrender/tool/color","../chart"],function(e){function t(e,t,r,h,o){i.call(this,e,t,r,h,o),this.refresh(h);var n=this;n._onclick=function(e){return n.__onclick(e)},n.zr.on(c.EVENT.CLICK,n._onclick)}var i=e("./base"),r=e("zrender/tool/area"),h=e("zrender/shape/Rectangle"),o=e("zrender/shape/Text"),n=e("zrender/shape/Line"),a=e("../layout/TreeMap"),l=e("../data/Tree"),s=e("../config");s.treemap={zlevel:0,z:1,calculable:!1,clickable:!0,center:["50%","50%"],size:["80%","80%"],root:"",itemStyle:{normal:{label:{show:!0,x:5,y:12,textStyle:{align:"left",color:"#000",fontFamily:"Arial",fontSize:13,fontStyle:"normal",fontWeight:"normal"}},breadcrumb:{show:!0,textStyle:{}},borderWidth:1,borderColor:"#ccc",childBorderWidth:1,childBorderColor:"#ccc"},emphasis:{}}};var d=e("../util/ecData"),c=e("zrender/config"),g=(e("zrender/tool/event"),e("zrender/tool/util")),u=e("zrender/tool/color");return t.prototype={type:s.CHART_TYPE_TREEMAP,refresh:function(e){this.clear(),e&&(this.option=e,this.series=this.option.series),this._treesMap={};for(var t=this.series,i=this.component.legend,r=0;r<t.length;r++)if(t[r].type===s.CHART_TYPE_TREEMAP){t[r]=this.reformOption(t[r]);var h=t[r].name||"";if(this.selectedMap[h]=!i||i.isSelected(h),!this.selectedMap[h])continue;this._buildSeries(t[r],r)}},_buildSeries:function(e,t){var i=l.fromOptionData(e.name,e.data);this._treesMap[t]=i;var r=e.root&&i.getNodeById(e.root)||i.root;this._buildTreemap(r,t)},_buildTreemap:function(e,t){for(var i=this.shapeList,r=0;r<i.length;){var h=i[r];d.get(h,"seriesIndex")===t?(this.zr.delShape(i[r]),i.splice(r,1)):r++}for(var o=i.length,n=this.series[t],l=n.itemStyle,s=this.parsePercent(n.size[0],this.zr.getWidth())||400,c=this.parsePercent(n.size[1],this.zr.getHeight())||500,g=this.parseCenter(this.zr,n.center),u=g[0]-.5*s,p=g[1]-.5*c,y=s*c,f=0,x=[],v=e.children,r=0;r<v.length;r++)f+=v[r].data.value;for(var m=0;m<v.length;m++)x.push(v[m].data.value*y/f);for(var b=new a({x:u,y:p,width:s,height:c}),w=b.run(x),_=0;_<w.length;_++){var z=v[_].data,T=w[_],S=[z.itemStyle,l],B=this.deepMerge(S);B.normal.color||(B.normal.color=this.zr.getColor(_)),B.emphasis.color||(B.emphasis.color=B.normal.color),this._buildItem(z,B,T,t,_),z.children&&this._buildChildrenTreemap(z.children,B,T,t)}this.query(n,"itemStyle.normal.breadcrumb.show")&&this._buildBreadcrumb(e,t,u,p+c);for(var r=o;r<i.length;r++)this.zr.addShape(i[r])},_buildItem:function(e,t,i,r,h){var o=this.series,n=this.getRectangle(e,t,i);d.pack(n,o[r],r,e,h,e.name),this.shapeList.push(n)},getRectangle:function(e,t,i){var r=t.emphasis,o=t.normal,n=this.getLabel(t,i,e.name,e.value),a=this.option.hoverable,l={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:a,clickable:!0,style:g.merge({x:i.x,y:i.y,width:i.width,height:i.height,brushType:"both",color:o.color,lineWidth:o.borderWidth,strokeColor:o.borderColor},n.style,!0),highlightStyle:g.merge({color:r.color,lineWidth:r.borderWidth,strokeColor:r.borderColor},n.highlightStyle,!0)};return new h(l)},getLabel:function(e,t,i,h){var o=e.normal.label.textStyle,n=[e.emphasis.label.textStyle,o],a=this.deepMerge(n),l=e.normal.label.formatter,s=this.getLabelText(i,h,l),d=this.getFont(o),c=r.getTextWidth(s,d),g=r.getTextHeight(s,d),u=this.deepQuery([e.emphasis,e.normal],"label.formatter"),p=this.getLabelText(i,h,u),y=this.getFont(a),f=r.getTextWidth(s,y),x=r.getTextHeight(s,y);e.normal.label.show?(e.normal.label.x+c>t.width||e.normal.label.y+g>t.height)&&(s=""):s="",e.emphasis.label.show?(a.x+f>t.width||a.y+x>t.height)&&(p=""):p="";var v={style:{textX:t.x+e.normal.label.x,textY:t.y+e.normal.label.y,text:s,textPosition:"specific",textColor:o.color,textFont:d},highlightStyle:{textX:t.x+e.emphasis.label.x,textY:t.y+e.emphasis.label.y,text:p,textColor:a.color,textPosition:"specific"}};return v},getLabelText:function(e,t,i){return i?"function"==typeof i?i.call(this.myChart,e,t):"string"==typeof i?(i=i.replace("{b}","{b0}").replace("{c}","{c0}"),i=i.replace("{b0}",e).replace("{c0}",t)):void 0:e},_buildChildrenTreemap:function(e,t,i,r){for(var h=i.width*i.height,o=0,n=[],l=0;l<e.length;l++)o+=e[l].value;for(var s=0;s<e.length;s++)n.push(e[s].value*h/o);for(var c=new a({x:i.x,y:i.y,width:i.width,height:i.height}),g=c.run(n),u=t.normal.childBorderWidth,p=t.normal.childBorderColor,y=0;y<g.length;y++){var f=g[y],x=[];i.y.toFixed(2)!==f.y.toFixed(2)&&x.push(this._getLine(f.x,f.y,f.x+f.width,f.y,u,p)),i.x.toFixed(2)!==f.x.toFixed(2)&&x.push(this._getLine(f.x,f.y,f.x,f.y+f.height,u,p)),(i.y+i.height).toFixed(2)!==(f.y+f.height).toFixed(2)&&x.push(this._getLine(f.x,f.y+f.height,f.x+f.width,f.y+f.height,u,p)),(i.x+i.width).toFixed(2)!==(f.x+f.width).toFixed(2)&&x.push(this._getLine(f.x+f.width,f.y,f.x+f.width,f.y+f.height,u,p));for(var v=0;v<x.length;v++)d.set(x[v],"seriesIndex",r),this.shapeList.push(x[v])}},_getLine:function(e,t,i,r,h,o){var a={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:e,yStart:t,xEnd:i,yEnd:r,lineWidth:h,strokeColor:o}};return new n(a)},_buildBreadcrumb:function(e,t,i,r){for(var h=[],n=e;n;)h.unshift(n.data.name),n=n.parent;for(var a=this.series[t],l=this.query(a,"itemStyle.normal.breadcrumb.textStyle")||{},s=this.query(a,"itemStyle.emphasis.breadcrumb.textStyle")||{},c={y:r+10,textBaseline:"top",textAlign:"left",color:l.color,textFont:this.getFont(l)},p={brushType:"fill",color:s.color||u.lift(l.color,-.3),textFont:this.getFont(s)},y=0;y<h.length;y++){var f=new o({zlevel:this.getZlevelBase(),z:this.getZBase(),style:g.merge({x:i,text:h[y]+(h.length-1-y?" > ":"")},c),clickable:!0,highlightStyle:p});d.set(f,"seriesIndex",t),d.set(f,"name",h[y]),i+=f.getRect(f.style).width,this.shapeList.push(f)}},__onclick:function(e){var t=e.target;if(t){var i=d.get(t,"seriesIndex"),r=d.get(t,"name"),h=this._treesMap[i],o=h.getNodeById(r);o&&o.children.length&&this._buildTreemap(o,i)}}},g.inherits(t,i),e("../chart").define("treemap",t),t}),define("echarts/layout/TreeMap",["require"],function(){function e(e){({x:e.x,y:e.y,width:e.width,height:e.height}),this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}return e.prototype.run=function(e){var t=[];return this._squarify(e,{x:this.x,y:this.y,width:this.width,height:this.height},t),t},e.prototype._squarify=function(e,t,i){var r="VERTICAL",h=t.width,o=t.height;t.width<t.height&&(r="HORIZONTAL",h=t.height,o=t.width);for(var n=this._getShapeListInAbstractRow(e,h,o),a=0;a<n.length;a++){n[a].x=0,n[a].y=0;for(var l=0;a>l;l++)n[a].y+=n[l].height}var s={};if("VERTICAL"==r){for(var d=0;d<n.length;d++)i.push({x:n[d].x+t.x,y:n[d].y+t.y,width:n[d].width,height:n[d].height});s={x:n[0].width+t.x,y:t.y,width:t.width-n[0].width,height:t.height}}else{for(var c=0;c<n.length;c++)i.push({x:n[c].y+t.x,y:n[c].x+t.y,width:n[c].height,height:n[c].width});s={x:t.x,y:t.y+n[0].width,width:t.width,height:t.height-n[0].width}}var g=e.slice(n.length);0!==g.length&&this._squarify(g,s,i)},e.prototype._getShapeListInAbstractRow=function(e,t,i){if(1===e.length)return[{width:t,height:i}];for(var r=1;r<e.length;r++){var h=this._placeFixedNumberRectangles(e.slice(0,r),t,i),o=this._placeFixedNumberRectangles(e.slice(0,r+1),t,i);if(this._isFirstBetter(h,o))return h}},e.prototype._placeFixedNumberRectangles=function(e,t,i){for(var r=e.length,h=[],o=0,n=0;n<e.length;n++)o+=e[n];for(var a=o/i,l=0;r>l;l++){var s=i*e[l]/o;h.push({width:a,height:s})}return h},e.prototype._isFirstBetter=function(e,t){var i=e[0].height/e[0].width;i=i>1?1/i:i;var r=t[0].height/t[0].width;return r=r>1?1/r:r,Math.abs(i-1)<=Math.abs(r-1)},e}),define("echarts/data/Tree",["require","zrender/tool/util"],function(e){function t(e,t){this.id=e,this.depth=0,this.height=0,this.children=[],this.parent=null,this.data=t||null}function i(e){this.root=new t(e)}var r=e("zrender/tool/util");return t.prototype.add=function(e){var t=this.children;e.parent!==this&&(t.push(e),e.parent=this)},t.prototype.remove=function(e){var t=this.children,i=r.indexOf(t,e);i>=0&&(t.splice(i,1),e.parent=null)},t.prototype.traverse=function(e,t){e.call(t,this);for(var i=0;i<this.children.length;i++)this.children[i].traverse(e,t)},t.prototype.updateDepthAndHeight=function(e){var t=0;this.depth=e;for(var i=0;i<this.children.length;i++){var r=this.children[i];r.updateDepthAndHeight(e+1),r.height>t&&(t=r.height)}this.height=t+1},t.prototype.getNodeById=function(e){if(this.id===e)return this;for(var t=0;t<this.children.length;t++){var i=this.children[t].getNodeById(e);if(i)return i}},i.prototype.traverse=function(e,t){this.root.traverse(e,t)},i.prototype.getSubTree=function(e){var t=this.getNodeById(e);if(t){var r=new i(t.id);return r.root=t,r}},i.prototype.getNodeById=function(e){return this.root.getNodeById(e)},i.fromOptionData=function(e,r){function h(e,i){var r=new t(e.name,e);i.add(r);var o=e.children;if(o)for(var n=0;n<o.length;n++)h(o[n],r)}var o=new i(e),n=o.root;n.data={name:e,children:r};for(var a=0;a<r.length;a++)h(r[a],n);return o.root.updateDepthAndHeight(0),o},i.fromGraph=function(e){function r(t){for(var i=e.getNodeById(t.id),h=0;h<i.outEdges.length;h++){var n=i.outEdges[h],a=o[n.node2.id];t.children.push(a),r(a)}}for(var h={},o={},n=0;n<e.nodes.length;n++){var a,l=e.nodes[n];0===l.inDegree()?(h[l.id]=new i(l.id),a=h[l.id].root):a=new t(l.id),a.data=l.data,o[l.id]=a}var s=[];for(var d in h)r(h[d].root),h[d].root.updateDepthAndHeight(0),s.push(h[d]);return s},i});